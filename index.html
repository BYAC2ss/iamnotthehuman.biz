<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Haxball-benzeri Oyun (HTML5)</title>
  <style>
    html,body{height:100%;margin:0;background:#0b1220;color:#fff;font-family:Arial}
    #game{display:block;margin:0 auto;background:#10304a;box-shadow:0 6px 20px rgba(0,0,0,.6);}
    #ui{width:900px;margin:12px auto;text-align:center}
    button{padding:8px 12px;margin:6px}
  </style>
</head>
<body>
  <div id="ui">
    <h2>Haxball-benzeri Oyun — Yerel 2 Oyuncu (WASD / Ok Tuşları)</h2>
    <div>1. Oyuncu: W A S D | 2. Oyuncu: ↑ ← ↓ → </div>
    <div id="score">0 — 0</div>
    <button id="restart">Yeniden Başlat</button>
    <button id="resetScores">Skorları Sıfırla</button>
  </div>
  <canvas id="game" width="900" height="520"></canvas>

<script>
// Basit Haxball-benzeri oyun: 2 oyuncu (yerel), top fiziği, çarpışma, goller
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');
const W = canvas.width, H = canvas.height;

// Oyun ayarları
const DT = 1/60; // sabit zaman adımı
const PLAYER_RADIUS = 18;
const BALL_RADIUS = 12;
const PLAYER_MAX_SPEED = 370; // px/s
const PLAYER_ACCEL = 2200; // px/s^2
const FRICTION = 0.98; // global yalınlaştırma
const BALL_FRICTION = 0.995;
const BALL_MAX_SPEED = 1200;

let scores = [0,0];

// Vektör yardımcıları
function v(x=0,y=0){return {x,y};}
function add(a,b){return {x:a.x+b.x,y:a.y+b.y};}
function sub(a,b){return {x:a.x-b.x,y:a.y-b.y};}
function mul(a,s){return {x:a.x*s,y:a.y*s};}
function len(a){return Math.hypot(a.x,a.y);} 
function norm(a){const L=len(a)||1; return {x:a.x/L,y:a.y/L};}

// Oyuncu sınıfı
class Player{
  constructor(x,y,keys,color){
    this.pos = v(x,y);
    this.vel = v();
    this.radius = PLAYER_RADIUS;
    this.keys = keys; // {up,down,left,right}
    this.color = color;
    this.idle = false;
  }
  update(dt,input){
    // input - set aktif tuşlar: {up:true,...}
    let acc = v();
    if (input[this.keys.up]) acc.y -= 1;
    if (input[this.keys.down]) acc.y += 1;
    if (input[this.keys.left]) acc.x -= 1;
    if (input[this.keys.right]) acc.x += 1;
    if (acc.x!==0 || acc.y!==0){
      acc = norm(acc);
      acc = mul(acc, PLAYER_ACCEL);
      this.vel.x += acc.x * dt;
      this.vel.y += acc.y * dt;
    } else {
      // hafif sürtünme
      this.vel.x *= 0.93;
      this.vel.y *= 0.93;
    }
    // hız sınırla
    const speed = len(this.vel);
    if (speed > PLAYER_MAX_SPEED){
      this.vel = mul(norm(this.vel), PLAYER_MAX_SPEED);
    }
    // pozisyon güncelle
    this.pos.x += this.vel.x * dt;
    this.pos.y += this.vel.y * dt;
    // sınırlarla çarp
    this.handleWallCollision();
  }
  handleWallCollision(){
    const r = this.radius;
    if (this.pos.x < r) { this.pos.x = r; this.vel.x *= -0.3; }
    if (this.pos.x > W - r) { this.pos.x = W - r; this.vel.x *= -0.3; }
    if (this.pos.y < r) { this.pos.y = r; this.vel.y *= -0.3; }
    if (this.pos.y > H - r) { this.pos.y = H - r; this.vel.y *= -0.3; }
  }
  draw(ctx){
    ctx.beginPath();
    ctx.fillStyle = this.color;
    ctx.arc(this.pos.x,this.pos.y,this.radius,0,Math.PI*2);
    ctx.fill();
    ctx.closePath();
    // göz
    ctx.fillStyle = '#fff';
    ctx.beginPath();
    ctx.arc(this.pos.x - this.radius/4, this.pos.y - this.radius/4, 3,0,Math.PI*2);
    ctx.fill();
  }
}

class Ball{
  constructor(x,y){
    this.pos = v(x,y);
    this.vel = v();
    this.radius = BALL_RADIUS;
  }
  update(dt){
    this.pos.x += this.vel.x * dt;
    this.pos.y += this.vel.y * dt;
    // friksiyon
    this.vel.x *= BALL_FRICTION;
    this.vel.y *= BALL_FRICTION;
    // sınırlar
    const r = this.radius;
    if (this.pos.x < r) { this.pos.x = r; this.vel.x *= -0.9; }
    if (this.pos.x > W - r) { this.pos.x = W - r; this.vel.x *= -0.9; }
    if (this.pos.y < r) { this.pos.y = r; this.vel.y *= -0.9; }
    if (this.pos.y > H - r) { this.pos.y = H - r; this.vel.y *= -0.9; }
    // max hız
    const s = len(this.vel);
    if (s > BALL_MAX_SPEED) this.vel = mul(norm(this.vel), BALL_MAX_SPEED);
  }
  draw(ctx){
    ctx.beginPath();
    ctx.fillStyle = '#ffd27f';
    ctx.arc(this.pos.x,this.pos.y,this.radius,0,Math.PI*2);
    ctx.fill();
    ctx.strokeStyle = '#b37b2f';
    ctx.stroke();
  }
}

// Oyun öğeleri
const p1 = new Player(W*0.2, H/2, {up:'w',down:'s',left:'a',right:'d'}, '#58a6ff');
const p2 = new Player(W*0.8, H/2, {up:'ArrowUp',down:'ArrowDown',left:'ArrowLeft',right:'ArrowRight'}, '#ff6b6b');
const ball = new Ball(W/2, H/2);

// Kontroller
const input = {};
window.addEventListener('keydown', e=>{ input[e.key] = true; });
window.addEventListener('keyup', e=>{ input[e.key] = false; });

// Çarpışma: iki daire
function resolveCircleCollision(a,b){
  const d = sub(b.pos, a.pos);
  const dist = len(d);
  const minDist = a.radius + b.radius;
  if (dist === 0) return;
  if (dist < minDist){
    const overlap = minDist - dist;
    const n = {x: d.x/dist, y: d.y/dist};
    // pozisyon düzeltme
    const totalMass = 1 + 1; // basit
    a.pos.x -= n.x * overlap * 0.5;
    a.pos.y -= n.y * overlap * 0.5;
    b.pos.x += n.x * overlap * 0.5;
    b.pos.y += n.y * overlap * 0.5;
    // hız değişimi (basit elastik)
    const rel = sub(b.vel, a.vel);
    const relAlongN = rel.x * n.x + rel.y * n.y;
    if (relAlongN > 0) return; // uzaklaşıyor
    const impulse = -(1.8) * relAlongN; // çarpışma kuvveti
    const impulseVec = mul(n, impulse);
    a.vel.x -= impulseVec.x * 0.5;
    a.vel.y -= impulseVec.y * 0.5;
    b.vel.x += impulseVec.x * 0.5;
    b.vel.y += impulseVec.y * 0.5;
  }
}

function playerBallCollision(player, ball){
  const d = sub(ball.pos, player.pos);
  const dist = len(d);
  const minDist = player.radius + ball.radius;
  if (dist < minDist && dist>0){
    const n = {x: d.x/dist, y: d.y/dist};
    const overlap = minDist - dist;
    // pozisyon düzeltme
    ball.pos.x += n.x * overlap * 1.02;
    ball.pos.y += n.y * overlap * 1.02;
    // topa ivme ver
    const relative = sub(ball.vel, player.vel);
    const speedAlong = relative.x * n.x + relative.y * n.y;
    const kick = 1.6; // vurma şiddeti
    const added = mul(n, player.idle ? 200 : (len(player.vel) * kick + 200));
    ball.vel.x = player.vel.x * 0.6 + added.x;
    ball.vel.y = player.vel.y * 0.6 + added.y;
    // top hızına sınır
    if (len(ball.vel) > BALL_MAX_SPEED) ball.vel = mul(norm(ball.vel), BALL_MAX_SPEED);
  }
}

// Kale kontrolü
const GOAL_W = 180;
const GOAL_H = 120;
function checkGoal(){
  // sol kale
  if (ball.pos.x - ball.radius <= 0){
    const y = ball.pos.y;
    if (y > (H-GOAL_H)/2 && y < (H+GOAL_H)/2){
      // gol sağ için
      scores[1]++;
      updateScoreUI();
      resetPositions();
      return true;
    }
  }
  // sağ kale
  if (ball.pos.x + ball.radius >= W){
    const y = ball.pos.y;
    if (y > (H-GOAL_H)/2 && y < (H+GOAL_H)/2){
      scores[0]++;
      updateScoreUI();
      resetPositions();
      return true;
    }
  }
  return false;
}

function updateScoreUI(){
  document.getElementById('score').innerText = scores[0] + ' — ' + scores[1];
}

function resetPositions(){
  p1.pos = v(W*0.2, H/2);
  p1.vel = v();
  p2.pos = v(W*0.8, H/2);
  p2.vel = v();
  ball.pos = v(W/2, H/2);
  ball.vel = v((Math.random()-0.5)*200, (Math.random()-0.5)*200);
}

// Ana döngü
let accumulator = 0;
let last = performance.now();
function loop(now){
  const elapsed = (now - last)/1000;
  last = now;
  accumulator += elapsed;
  while (accumulator >= DT){
    step(DT);
    accumulator -= DT;
  }
  render();
  requestAnimationFrame(loop);
}

function step(dt){
  // oyuncuları güncelle
  p1.update(dt,input);
  p2.update(dt,input);
  // topu güncelle
  ball.update(dt);
  // çarpışmalar
  // oyuncu-oyuncu
  resolveCircleCollision(p1,p2);
  // oyuncu-top
  playerBallCollision(p1,ball);
  playerBallCollision(p2,ball);
  // skor kontrolü
  checkGoal();
}

function drawField(){
  // zemin
  ctx.fillStyle = '#08324b';
  ctx.fillRect(0,0,W,H);
  // orta çizgi
  ctx.strokeStyle = 'rgba(255,255,255,0.08)';
  ctx.lineWidth = 2;
  ctx.beginPath(); ctx.moveTo(W/2,20); ctx.lineTo(W/2,H-20); ctx.stroke(); ctx.closePath();
  // orta daire
  ctx.beginPath(); ctx.strokeStyle='rgba(255,255,255,0.12)'; ctx.lineWidth=2;
  ctx.arc(W/2,H/2,70,0,Math.PI*2); ctx.stroke(); ctx.closePath();
  // kaleler
  ctx.fillStyle = '#042733';
  ctx.fillRect(0,(H-GOAL_H)/2,8,GOAL_H);
  ctx.fillRect(W-8,(H-GOAL_H)/2,8,GOAL_H);
}

function render(){
  // temizle
  ctx.clearRect(0,0,W,H);
  drawField();
  // çizgiler ve skor
  // top ve oyuncular
  ball.draw(ctx);
  p1.draw(ctx);
  p2.draw(ctx);
  // küçük rehber
  ctx.fillStyle = 'rgba(255,255,255,0.08)';
  ctx.fillRect((W/2)-1,0,2,20);
}

// UI butonlar
document.getElementById('restart').addEventListener('click', ()=>{ resetPositions(); });
document.getElementById('resetScores').addEventListener('click', ()=>{ scores=[0,0]; updateScoreUI(); resetPositions(); });

// başlangıç
resetPositions();
updateScoreUI();
requestAnimationFrame(loop);

</script>
</body>
</html>
