<!doctype html>
<html lang="tr">
<head>
Â  <meta charset="utf-8" />
Â  <meta name="viewport" content="width=device-width,initial-scale=1" />
Â  <title>Haxball-benzeri Oyun (HTML5) - Online</title>
Â  <style>
Â  Â  html, body {
Â  Â  Â  height: 100%;
Â  Â  Â  margin: 0;
Â  Â  Â  background: #0b1220;
Â  Â  Â  color: #fff;
Â  Â  Â  font-family: Arial, sans-serif;
Â  Â  }

Â  Â  #game {
Â  Â  Â  display: block;
Â  Â  Â  margin: 0 auto;
Â  Â  Â  background: #10304a;
Â  Â  Â  box-shadow: 0 6px 20px rgba(0, 0, 0, 0.6);
Â  Â  }

Â  Â  #ui {
Â  Â  Â  width: 900px;
Â  Â  Â  margin: 12px auto;
Â  Â  Â  text-align: center;
Â  Â  }

Â  Â  button {
Â  Â  Â  padding: 8px 12px;
Â  Â  Â  margin: 6px;
Â  Â  Â  font-size: 16px;
Â  Â  Â  cursor: pointer;
Â  Â  Â  border: none;
Â  Â  Â  border-radius: 4px;
Â  Â  Â  background: #58a6ff;
Â  Â  Â  color: #0b1220;
Â  Â  Â  transition: background 0.3s;
Â  Â  }
Â  Â  button:hover {
Â  Â  Â  background: #79b7ff;
Â  Â  }

Â  Â  h2 {
Â  Â  Â  font-size: 24px;
Â  Â  }
Â  Â  
Â  Â  #score {
Â  Â  Â  font-size: 24px;
Â  Â  Â  margin: 12px;
Â  Â  }

Â  Â  #roomIdInput {
Â  Â  Â  padding: 8px;
Â  Â  Â  margin: 6px;
Â  Â  Â  font-size: 16px;
Â  Â  Â  border: none;
Â  Â  Â  border-radius: 4px;
Â  Â  Â  width: 150px;
Â  Â  Â  background: #1e3a5f;
Â  Â  Â  color: #fff;
Â  Â  }

Â  Â  #status {
Â  Â  Â  color: #ff6b6b;
Â  Â  Â  font-weight: bold;
Â  Â  Â  margin-top: 10px;
Â  Â  }
    .supershot-ready {
        color: #70ff70;
        font-weight: bold;
    }
    .supershot-cooldown {
        color: #ffa07a;
    }

Â  </style>
</head>
<body>

Â  <div id="ui">
Â  Â  <h2>Haxball-benzeri Oyun â€” Ã‡evrimiÃ§i</h2>
Â  Â  
Â  Â  <div id="room-setup">
Â  Â  Â  <input type="text" id="roomIdInput" placeholder="Oda ID Girin">
Â  Â  Â  <button id="createRoom">Oda Kur</button>
Â  Â  Â  <button id="joinRoom">Odaya KatÄ±l</button>
Â  Â  </div>
Â  Â  <div id="status">Sunucuya baÄŸlanÄ±yor...</div>
     <div id="supershot-status" style="display:none; margin-top: 10px;">SÃ¼per VuruÅŸ: <span id="supershot-state">YÃ¼kleniyor...</span></div>


Â  Â  <div id="game-controls" style="display:none;">
Â  Â  Â  <div id="score">0 â€” 0</div>
Â  Â  Â  <button id="restart">Yeniden BaÅŸlat</button>
Â  Â  Â  <button id="resetScores">SkorlarÄ± SÄ±fÄ±rla</button>
Â  Â  </div>
Â  </div>

Â  <canvas id="game" width="900" height="520"></canvas>

Â  Â  <script src="/socket.io/socket.io.js"></script> 

Â  <script>
    // Canvas ve context tanÄ±mlamalarÄ±
    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d');
    const W = canvas.width, H = canvas.height;

    // Oyun ayarlarÄ± (Ã‡oÄŸu sunucu tarafÄ±ndan yÃ¶netilecek)
    const DT = 1 / 60;
    const PLAYER_RADIUS = 18;
    const BALL_RADIUS = 12;
    let scores = [0, 0];
    
    // YENÄ°: Kontrol tuÅŸlarÄ± (iki oyuncu da aynÄ± tuÅŸlarÄ± kullanacak, sunucu hangisinin hangi tuÅŸa bastÄ±ÄŸÄ±nÄ± ayÄ±racak)
    const PLAYER_CONTROLS = {
        up: 'w',
        down: 's',
        left: 'a',
        right: 'd',
        supershot: ' ' // BoÅŸluk tuÅŸu (Spacebar)
    };

    // VektÃ¶r yardÄ±mcÄ± fonksiyonlar
    function v(x = 0, y = 0) { return { x, y }; }
    function len(a) { return Math.hypot(a.x, a.y); }

    // Oyuncu sÄ±nÄ±fÄ± - SADECE Ã‡Ä°ZÄ°M Ä°Ã‡Ä°N KULLANILACAK
    class Player {
      constructor(x, y, color) {
        this.pos = v(x, y);
        this.radius = PLAYER_RADIUS;
        this.color = color;
        this.isSuperShooting = false; // Supershot animasyon/gÃ¶rsel efekt iÃ§in
      }
      
      draw(ctx) {
        ctx.beginPath();
        // SÃ¼per VuruÅŸ anÄ±nda oyuncuyu parlatabiliriz (gÃ¶rsel feedback)
        if (this.isSuperShooting) {
            ctx.shadowBlur = 10;
            ctx.shadowColor = '#fff';
        }
        ctx.fillStyle = this.color;
        ctx.arc(this.pos.x, this.pos.y, this.radius, 0, Math.PI * 2);
        ctx.fill();
        ctx.closePath();
        
        ctx.shadowBlur = 0; // GÃ¶lgeyi kapat
        
        // GÃ¶z/IÅŸÄ±k Ã§izimi
        ctx.fillStyle = '#fff';
        ctx.beginPath();
        ctx.arc(this.pos.x - this.radius / 4, this.pos.y - this.radius / 4, 3, 0, Math.PI * 2);
        ctx.fill();
      }
    }

    // Top sÄ±nÄ±fÄ± - SADECE Ã‡Ä°ZÄ°M Ä°Ã‡Ä°N KULLANILACAK
    class Ball {
      constructor(x, y) {
        this.pos = v(x, y);
        this.radius = BALL_RADIUS;
        this.isSupershotBall = false; // Topun SÃ¼per VuruÅŸ anÄ±nda parlamasÄ± iÃ§in
      }
      
      draw(ctx) {
        ctx.beginPath();
        ctx.fillStyle = '#ffd27f';
        
        // SÃ¼per VuruÅŸ anÄ±nda topu parlat
        if (this.isSupershotBall) {
            ctx.shadowBlur = 15;
            ctx.shadowColor = '#ff6b6b';
        }

        ctx.arc(this.pos.x, this.pos.y, this.radius, 0, Math.PI * 2);
        ctx.fill();
        ctx.strokeStyle = '#b37b2f';
        ctx.stroke();
        
        ctx.shadowBlur = 0; // GÃ¶lgeyi kapat
      }
    }

    // Oyuncu ve top nesneleri
    const p1 = new Player(W * 0.2, H / 2, '#58a6ff');
    const p2 = new Player(W * 0.8, H / 2, '#ff6b6b');
    const ball = new Ball(W / 2, H / 2);

    // ===================================================================
    // ðŸ“¢ Ã‡EVRÄ°MÄ°Ã‡Ä° OYUN MANTIÄžI VE SOCKET.IO BAÄžLANTISI 
    // ===================================================================

    const socket = io(); 
    let currentRoomId = null;
    let isGameRunning = false;
    let isPlayer1 = false;
    
    // DOM Elementleri
    const input = {}; 
    const statusDiv = document.getElementById('status');
    const gameControlsDiv = document.getElementById('game-controls');
    const supershotStatusDiv = document.getElementById('supershot-status');
    const supershotStateSpan = document.getElementById('supershot-state');

    // Sunucu OlaylarÄ± Dinleniyor
    socket.on('connect', () => {
        statusDiv.innerText = 'Sunucuya baÄŸlandÄ±. Oda kurun veya katÄ±lÄ±n.';
    });

    socket.on('roomCreated', (roomId) => {
        currentRoomId = roomId;
        isPlayer1 = true;
        statusDiv.innerText = `Oda kuruldu: ${roomId}. WASD ve BOÅžLUK (SÃ¼per VuruÅŸ) kullanacaksÄ±n. ArkadaÅŸÄ±nÄ± bekle...`;
        document.getElementById('roomIdInput').value = roomId;
    });

    socket.on('roomJoined', (roomId) => {
        currentRoomId = roomId;
        isPlayer1 = false; 
        statusDiv.innerText = `Odaya katÄ±ldÄ±nÄ±z: ${roomId}. WASD ve BOÅžLUK (SÃ¼per VuruÅŸ) kullanacaksÄ±n. Rakip bekleniyor...`;
    });

    socket.on('gameStart', (playerAssignment) => {
        isGameRunning = true;
        isPlayer1 = playerAssignment.playerIndex === 0;
        statusDiv.innerText = `OYUN BAÅžLADI! Sen ${isPlayer1 ? '1. Oyuncusun' : '2. Oyuncusun'}. WASD/BOÅžLUK ile oyna.`;
        gameControlsDiv.style.display = 'block';
        supershotStatusDiv.style.display = 'block';
        document.getElementById('room-setup').style.display = 'none';
        requestAnimationFrame(loop); 
    });

    socket.on('gameStateUpdate', (gameState) => {
        if (isGameRunning) {
            // PozisyonlarÄ± gÃ¼ncelle
            p1.pos.x = gameState.p1.pos.x;
            p1.pos.y = gameState.p1.pos.y;
            p2.pos.x = gameState.p2.pos.x;
            p2.pos.y = gameState.p2.pos.y;
            ball.pos.x = gameState.ball.pos.x;
            ball.pos.y = gameState.ball.pos.y;
            
            // SÃ¼per VuruÅŸ GÃ¶rsel Durumu GÃ¼ncelle (Ani VuruÅŸ GÃ¶rseli iÃ§in)
            p1.isSuperShooting = gameState.p1.isSuperShooting;
            p2.isSuperShooting = gameState.p2.isSuperShooting;
            ball.isSupershotBall = gameState.ball.isSupershotBall;

            scores[0] = gameState.scores[0];
            scores[1] = gameState.scores[1];
            updateScoreUI();
        }
    });
    
    socket.on('superShotReady', (data) => {
        // Sadece kendi durumumuzu gÃ¼ncelleyelim
        const localPlayer = isPlayer1 ? 0 : 1;
        if (data.playerIndex === localPlayer) {
            supershotStateSpan.innerText = 'HAZIR!';
            supershotStateSpan.className = 'supershot-ready';
        }
    });

    socket.on('superShotCooldown', (data) => {
        const localPlayer = isPlayer1 ? 0 : 1;
        if (data.playerIndex === localPlayer) {
            supershotStateSpan.innerText = 'YÃ¼kleniyor (5sn)...';
            supershotStateSpan.className = 'supershot-cooldown';
        }
    });

    socket.on('gameReset', () => {
        statusDiv.innerText = 'GOOLL!! Oyun SÄ±fÄ±rlandÄ±!';
    });
    
    socket.on('error', (message) => {
        statusDiv.innerText = `Hata: ${message}`;
        gameControlsDiv.style.display = 'none';
        supershotStatusDiv.style.display = 'none';
        document.getElementById('room-setup').style.display = 'block';
    });

    // Kontroller: TuÅŸ basÄ±ÅŸlarÄ±nÄ± SADECE sunucuya iletiyoruz
    window.addEventListener('keydown', e => { 
        // TuÅŸu kÃ¼Ã§Ã¼k harfe Ã§evir
        const key = e.key.toLowerCase(); 
        const isControlKey = Object.values(PLAYER_CONTROLS).includes(key);

        if (isControlKey && !input[key]) {
            input[key] = true; 
            if (currentRoomId && isGameRunning) {
                socket.emit('playerInput', { roomId: currentRoomId, key: key, pressed: true });
            }
        }
    });

    window.addEventListener('keyup', e => { 
        const key = e.key.toLowerCase(); 
        
        if (input[key]) {
            input[key] = false; 
            if (currentRoomId && isGameRunning) {
                socket.emit('playerInput', { roomId: currentRoomId, key: key, pressed: false });
            }
        }
    });

    // UI ButonlarÄ±na Socket.IO MantÄ±ÄŸÄ±
    document.getElementById('createRoom').addEventListener('click', () => {
        const newRoomId = Math.random().toString(36).substring(2, 6).toUpperCase(); 
        document.getElementById('roomIdInput').value = newRoomId;
        socket.emit('createRoom', newRoomId);
    });

    document.getElementById('joinRoom').addEventListener('click', () => {
        const roomId = document.getElementById('roomIdInput').value.trim().toUpperCase();
        if (roomId) {
            socket.emit('joinRoom', roomId);
        } else {
            statusDiv.innerText = "LÃ¼tfen geÃ§erli bir Oda ID girin.";
        }
    });
    
    document.getElementById('restart').addEventListener('click', () => { 
        if (currentRoomId) {
            socket.emit('restartGame', { roomId: currentRoomId });
        }
    });

    document.getElementById('resetScores').addEventListener('click', () => { 
        if (currentRoomId) {
            socket.emit('resetScores', { roomId: currentRoomId });
        }
    });


    // ===================================================================
    // ðŸ“¢ Ã‡Ä°ZÄ°M VE YARDIMCI FONKSÄ°YONLAR
    // ===================================================================
    
    function updateScoreUI() {
      document.getElementById('score').innerText = scores[0] + ' â€” ' + scores[1];
    }
    
    // FÄ°ZÄ°K HESAPLAMALARINI Ä°Ã‡EREN TÃœM FONKSÄ°YONLAR SÄ°LÄ°NDÄ°/PASÄ°FÄ°ZE EDÄ°LDÄ°
    // Sadece Ã§izim dÃ¶ngÃ¼sÃ¼ kaldÄ±.
    function loop(now) {
      // FÄ°ZÄ°K HESAPLAMASI YOK (Sunucu yapÄ±yor)
      render(); 
      if (isGameRunning) {
        requestAnimationFrame(loop);
      }
    }

    function drawField() {
      // Saha Ã§izimi deÄŸiÅŸmedi
      const GOAL_H = 120;
      ctx.fillStyle = '#08324b';
      ctx.fillRect(0, 0, W, H);
      ctx.strokeStyle = 'rgba(255, 255, 255, 0.08)';
      ctx.lineWidth = 2;
      ctx.beginPath();
      ctx.moveTo(W / 2, 20);
      ctx.lineTo(W / 2, H - 20);
      ctx.stroke();
      ctx.closePath();
      ctx.beginPath();
      ctx.strokeStyle = 'rgba(255, 255, 255, 0.12)';
      ctx.lineWidth = 2;
      ctx.arc(W / 2, H / 2, 70, 0, Math.PI * 2);
      ctx.stroke();
      ctx.closePath();
      ctx.fillStyle = '#042733';
      ctx.fillRect(0, (H - GOAL_H) / 2, 8, GOAL_H);
      ctx.fillRect(W - 8, (H - GOAL_H) / 2, 8, GOAL_H);
    }

    function render() {
      ctx.clearRect(0, 0, W, H);
      drawField();
      ball.draw(ctx);
      p1.draw(ctx);
      p2.draw(ctx);
    }

    // BaÅŸlangÄ±Ã§ 
    updateScoreUI();
Â  </script>

</body>
</html>
