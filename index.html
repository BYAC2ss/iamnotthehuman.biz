<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Multiplayer Haxball Clone</title>
  <style>
    body { background: #222; overflow:hidden; }
    canvas { background:#333; display:block; margin:auto; }
  </style>
</head>
<body>

<canvas id="game" width="800" height="600"></canvas>

<script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>

<script>
const socket = io("https://iamnotthehuman-biz-node.onrender.com");

const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

let players = {};
let ball = { x: 400, y:300 };

// İlk veri
socket.on("init", (data)=> {
  players = data.players;
  ball = data.ball;
});

// Canlı güncelleme
socket.on("state", (data)=> {
  players = data.players;
  ball = data.ball;
});

document.addEventListener("keydown", (e)=>{
  if (["up","down","left","right"].includes(key(e.key))) {
    socket.emit("keydown", key(e.key));
  }
});

document.addEventListener("keyup", (e)=>{
  if (["up","down","left","right"].includes(key(e.key))) {
    socket.emit("keyup", key(e.key));
  }
});

function key(k){
  return {
    "w":"up","ArrowUp":"up",
    "s":"down","ArrowDown":"down",
    "a":"left","ArrowLeft":"left",
    "d":"right","ArrowRight":"right"
  }[k];
}

function draw(){
  ctx.clearRect(0,0,800,600);

  // Top
  ctx.fillStyle="white";
  ctx.beginPath();
  ctx.arc(ball.x, ball.y, 12, 0, Math.PI*2);
  ctx.fill();

  // Oyuncular
  for (let id in players) {
    let p = players[id];
    ctx.fillStyle="cyan";
    ctx.beginPath();
    ctx.arc(p.x, p.y, 15, 0, Math.PI*2);
    ctx.fill();
  }

  requestAnimationFrame(draw);
}
draw();
</script>

</body>
</html>
