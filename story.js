 const seasons = {
      1: [
`Puberty Syndrome – An abnormal experiences rumored on the internet to be caused by sensitivity and instability during adolescence. This year, Sakuta Azusagawa, a second-year student at Minegahara high school near Enoshima, meets several girls that are experiencing this “puberty syndrome.” For instance, he meets a wild bunny girl in the library. She turns out to be an actress on hiatus, Mai Sakurajima, who is also his senior at the school. For some reason, no one else can see this enchanting girl.`,
`Sakuta continues to investigate the cause of Mai’s puberty syndrome. Somehow, he also ends up scheduling a date with her. On his way to meet up with Mai at Fujisawa Station, he comes across a lost girl, who he tries to help out. But instead, he is mistaken for a pervert by another girl and winds up being late to the date. Mai eventually forgives him and they go on with their date, but she decides to change their plans and takes Sakuta to Shichirigahama instead...`,
`Even after leaving Fujisawa for Ogaki, not one person remembered anything about Mai Sakurajima. Sakuta and Mai return to school together, but even there they hear from Sakuta's friend Rio Futaba that nobody at school outside of her has any recollection about Mai. At the same time, Sakuta hears of a theory that losing memories concerning Mai is based on a certain action taken, and struggles so that he doesn't lose his memories of her. And seeing Sakuta act as such, Mai makes a certain decision of her own as well.`,
`After Mai's "puberty syndrome" is resolved, Sakuta encounters another strange phenomenon without respite. Day after day, it is the same day for Sakuta and there is no tomorrow. When he consults Rio, she raises the possibility of "Laplace’s demon" -- that someone may be repeating and redoing a day.`,
`Because of the misunderstanding that she was dating Sakuta, Tomoe is able to resolve the agonizing situation of being asked out by the guy her friend is in love with. She pleads with Sakuta to continue acting like they are dating. Despite feeling indebted to Mai, Sakuta could not leave Tomoe alone as she was fearing that she would lose her presence within her class. So, he reluctantly agrees to play the role of Tomoe's fake boyfriend for a while.`,
`It is the last day of the first semester, which also means the end of Sakuta’s fake relationship with Tomoe. After their final date at Shichirigahama, Sakuta and Tomoe decide on the reason for their break up, which is that Tomoe dumps Sakuta after being fed up with him for still having feelings for Mai. It seems as though everything is finally resolved, but…`,
`With the end of a very long June and July, Sakuta is finally officially in a relationship with Mai. However, Mai is very busy with work and the two have not had the chance to see each other at all. Harboring some resentment, Sakuta works his part-time job when one day Mai, who just got off work, suddenly shows up. With Mai’s suggestion that she will make it up to him for her absence, Sakuta excitedly finishes his work shift. On their way home, they witness Rio entering an internet café in downtown. Finding this suspicious, Sakuta follows her and discovers an unexpected truth from Rio…`,
`Upon inducing a case of “Puberty Syndrome” where two copies of herself exists, Rio ends up staying at Sakuta's house for the time being. Meanwhile, "the other Rio" has been busy posting various unexpected photos on social media. After being informed about these activities by his classmate, Saki Kamisato, Sakuta decides to have a chat with “the other Rio.” As he learns more about each of the Rio-s in hopes of discovering the reason for “the other Rio’s” actions and possibly a cure for her “Puberty Syndrome,” Sakuta begins to realize the troubles each of them carry.`,
`After a no-dating rule is imposed by her management, Mai is too busy with work to spend any time with Sakuta. As he excitedly welcomes the start of the second trimester and the opportunity to see Mai at school, Sakuta is shocked to be asked “who are you?” when he runs into Mai in front of his house. Upon looking into the situation, he discovers that Mai and her little sister, Nodoka Toyohama, have switched bodies. Until they can resolve this case of the “Puberty Syndrome,” Mai must spend her days as Nodoka and Nodoka must spend her days as Mai...`,
`Unhappy with her performance on the commercial shoot as actress Mai Sakurajima, Nodoka is increasingly harboring a sense of inferiority. The half-sisters are still stuck in their switched bodies, and Mai must now perform in a live concert as Nodoka for the idol group “Sweet Palette.” After receiving tickets to the concert, Sakuta and Nodoka decide to attend the show, but...`,
`With Nodoka's puberty syndrome resolved, Sakuta is excited to finally be able to spend time with Mai as a couple. Just when all seemed hopeful for Sakuta, a scandal breaks out regarding Mai Sakurajima having a boyfriend. As Mai provides a sincere explanation at a press conference for her movie, Kaede realizes that she also wants to be strong for Sakuta and decides to set several goals for herself this year. Among those goals is going back to school...`,
`Kaede insists that she does not remember her childhood friend, Kotomi Kano, when the two run into each other at Shichirigahama. Concluding that Kaede has lost her memory, Sakuta decides to open up to Mai and Nodoka about what happened two years ago. Meanwhile, Kaede continues to practice going back to school after her encounter with Kotomi, but...`,
`After a successful visit to the school at night with Sakuta's help, Kaede feels a little more confident and is enthusiastic about going to school during the day next. However, the original Kaede's traumatic memories suddenly return the following day, eradicating all memories of the Kaede that had spent the last two years with Sakuta. As Sakuta is desolate and stricken with grief, a certain individual appears before him.`
      ],
      2: [
    `Six months into his university life, Sakuta Azusagawa is enjoying a peaceful campus life, surrounded by familiar faces like Mai and Nodoka. Nodoka expresses concern about her idol group Sweet Bullet as Uzuki gets more solo offers. The next day, Sakuta notices something strange about Uzuki when she arrives for class.`,
    `Uzuki blends into the university crowd too perfectly. Sakuta suspects Puberty Syndrome. While Uzuki’s fame increases, she struggles in rehearsals and isolates herself. One day Sakuta sees her on a train, refusing to get off, and follows her.`,
    `The joint Odaiba concert day arrives. Uzuki’s voice suddenly disappears on stage. The next day Sweet Bullet performs with four members, without her.`,
    `A mini-skirted Santa calling herself Touko Kirishima appears before Sakuta, saying she gives people Adolescence Syndrome. She’s targeting Ikumi Akagi, Sakuta’s old classmate. Sakuta attends a mixer and hears about #DreamSeer, a trend where dreams come true.`,
    `Just as posted under #Yumemiru, a glass lantern falls but Ikumi saves a girl. Later she gives Sakuta a reunion invitation. Sakuta warns her not to overdo helping people, but she gets upset.`,
    `Ikumi is attacked by poltergeist-like events. She says the only fix is forgetting Sakuta. She challenges him: will he remember first or will she forget first? Sakuta later learns she still feels guilt from middle school for not saving him.`,
    `Searching #dreaming shows posts about a reunion on November 27. Ikumi dreams she commits an assault there. Sakuta takes her to Minegahara. On the way back, she suddenly says goodbye at the crossing and...`,
    `A message from another Sakuta says: “Mai is in danger.” He tries to contact Touko. She agrees to meet only on December 2, Mai’s birthday. Sakuta cancels his date. Touko might also be experiencing Adolescence Syndrome.`,
    `On Christmas Eve, Sakuta dreams he’s on a date with Sara Himeji. Sara has the same dream and says she has Puberty Syndrome but doesn't want a cure. She provocatively asks how she can fall in love like Sakuta does.`,
    `Sakuta finds a mini-skirt Santa named Nene Iwamizawa in a beauty contest, not Touko. Sara helps search and suggests reading Santa’s mind during a livestream.`,
    `Sakuta dreams Mai will reveal she is Touko. #Dreaming causes chaos. Tomoe dreams Mai gets injured during a police chief event. Touko appears again.`,
    `On Coming of Age Day, Mai denies she is Touko. Rumors persist. Sakuta and Mai go on a date. Mini-skirt Santa isn’t recognized by anyone. Sakuta asks about her past and an old boyfriend comes up.`,
    `After Takumi forgets her, Nene forgets herself and believes she is Touko. Only Takumi can cure her. Sakuta and Ikumi fly to Hokkaido to find him, showing him Nene’s old trophy.`
  ]
};
const episodesList = document.getElementById('episodesList');
const seasonLabel = document.getElementById('seasonLabel');
const tabBtns = document.querySelectorAll('.tab-btn');
let activeSeason = 1;

function renderSeason(season){
  episodesList.innerHTML = '';
  const eps = seasons[season] || [];
  eps.forEach((text, idx)=>{
    const n = idx+1;
    const card = document.createElement('div');
    card.className='ep-card';
    card.tabIndex=0;
    card.setAttribute('data-ep', n);
    card.innerHTML=`
      <div class="ep-badge">${n}</div>
      <div class="ep-meta">
        <h3>Episode ${n}</h3>
        <p>${text.slice(0,180)}${text.length>180?'…':''}</p>
      </div>
    `;
    card.addEventListener('click', ()=>openDetail(season,n,text));
    card.addEventListener('keydown', (e)=>{ if(e.key==='Enter') openDetail(season,n,text); });
    episodesList.appendChild(card);
  });
  seasonLabel.textContent=`Season ${season}`;
}

function openDetail(season, number, text){
  console.log('openDetail çalıştı', season, number);
  document.getElementById('overlay').classList.add('open');
  document.getElementById('epNumber').textContent = number;
  document.getElementById('epTitle').textContent = `Episode ${number}`;
  document.getElementById('epSub').textContent = `Season ${season}`;
  const epTextEl = document.getElementById('epText');
  epTextEl.textContent = text;
  document.body.style.overflow='hidden';
}

function closeDetail(){
  document.getElementById('overlay').classList.remove('open');
  document.body.style.overflow='';
}

document.getElementById('closeDetail').addEventListener('click', closeDetail);
document.getElementById('overlay').addEventListener('click', e => {
  if(e.target.id === 'overlay') closeDetail();
});

tabBtns.forEach(btn=>{
  btn.addEventListener('click', ()=>{
    tabBtns.forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');
    activeSeason = Number(btn.dataset.season);
    renderSeason(activeSeason);
  });
});

// Dropdown menü
const menuRoot = document.getElementById('menuRoot');
const menuBtn = document.getElementById('menuBtn');
menuBtn.addEventListener('click', e => {
  e.stopPropagation();
  menuRoot.classList.toggle('open');
});
document.addEventListener('click', () => menuRoot.classList.remove('open'));

// Loading ekranı
window.addEventListener("load", () => {
  setTimeout(() => {
    const load = document.getElementById("loading");
    if (load) load.remove(); 
  }, 1700);
});

renderSeason(1);
